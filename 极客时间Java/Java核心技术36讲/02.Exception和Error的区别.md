## Exception 和 Error 的区别,运行时异常与一般异常有什么区别

Exception 和 Error 都继承自 Throwable 类, Java 中只有 Throwable 类型的实例才可以被抛出(throw)或捕获(catch),它是异常处理机制的基本组成类型.

Exception 是程序运行中可以预料的意外情况,应该被捕获并进行相应处理.

Error 是正常情况下不大可能出现的情况,大部分 Error 会导致程序处于异常或不可恢复的状态,如 OutOfMemoryError.

Exception 又分可检查异常(checked)和不可检查(unchecked)异常,可检查异常在源代码里必须显式捕获,不可检查的异常如 `NullPointerException`, `ArrayIndexOutofBoundsException` 通常可以避免编码的逻辑错误.

## 考察内容

- 理解 Throwable, Exception, Error 的设计和分类.

    掌握那些应用广泛的子类以及如何自定义异常.

    了解哪些 Error, Exception 或者 RuntimeException.

    ![1](https://static001.geekbang.org/resource/image/ac/00/accba531a365e6ae39614ebfa3273900.png)

    NoClassDefFoundError 和 ClassNotFoundException 有什么区别.

- 理解 Java 语言中操作 Throwable 的元素和实践.

    try catch 使用方法:

    ```java
    try (BufferedReader br = new BufferedReader(…);
    BufferedWriter writer = new BufferedWriter(…)) {// Try-with-resources
    // do something
    catch ( IOException | XEception e) {// Multiple catch
    // Handle it
    } 
    ```

## 扩展

1. 看一下面这段代码,有什么问题:

    ```java
    try {
    // 业务代码
    // …
    Thread.sleep(1000L);
    } catch (Exception e) {
    // Ignore it
    }
    ```

    - 尽量不要捕获类似 Exception 这样的通用异常,应该捕获特定异常.

        这里应该捕获 Thread.sleep() 抛出的 InterruptedException

    - 不要生吞(swallow)异常

        因为这样可能导致非常难以诊断的诡异情况.

        如果我们没有把异常抛出来或者没有输出到日志(Logger),程序可能在后续代码中以不可控的方式结束,无法判断到底哪里出了问题以及什么原因导致了异常.


2. 看一下第二段代码:

    ```java
    try {
    // 业务代码
    // …
    } catch (IOException e) {
        e.printStackTrace();
    }
    ```

    这段代码使用了 `printStackTrace()` 打印异常,但是通常情况下仅仅使用 `printStackTrace()` 是无法判断到底哪里出了问题,尤其是分布式系统,最好使用产品日志,详细输出到日志系统里.

3. try catch 机制

- 性能角度

    try catch 会产生额外的性能开销,影响 JVM 对代码的优化,建议仅捕获必要的代码段.另外不要使用异常控制代码流,因为没有 if else / switch 高效.

    Java 每实例化一个 Exception,都会对当前的栈进行快照,性能开销较大.

当我们的服务出现反应变慢、吞吐量下降的时候，检查发生最频繁的 Exception 也是一种思路。
