Java 语言特性：`"Write once, run anywhere"`。

## 谈谈你对 Java 平台的理解

Java 是一种面向对象语言，有两个显著的特性：`一次书写，到处运行`和`垃圾回收`。Java 通过垃圾收集器 (Gabage Collector) 回收内存，大部分情况下，开发人员不需要操心内存的分配和回收问题。

日常接触的 JRE(Java Runtime Environment) 或者 JDK(Java Development Kit) 分别表示 Java 运行环境以及 Java 开发环境。其中 JRE 包含 JVM 和 Java 类库以及一些模块等；JDK 可以看作为 JRE 的一个超集，提供有更多工具如编译器、各种诊断工具等。

Java 源代码需要先通过 Javac 编译成字节码 (bytecode) ，然后运行时通过 Java 虚拟机 JVM 内嵌的解释器将字节码转换成机器码后执行。常见的 JVM ，比如 Oracle JDK 提供的 Hotspot JVM 都提供了 JIT(Just-In-Time) 编译器，JIT指的是动态编译器，能够在运行时将热点代码编译成机器码，这种情况被编译的那部分代码就是**编译执行**，而不是解释执行了。

## 考察内容

这里主要考察基础知识、 Java 平台主要模块和运行原理等。

回答这类问题需要表现出自己的思维深度并系统化， java 知识理解得比较全面，不能知其然不知其所以然。

## 扩展

java 平台的理解可以从多个方面展开：

- Java 语言特性，包括泛型、Lambda等语言特性

- 基础类库，包括集合、IO/NIO、网络、并发、安全等基础类库。

- JVM 的一些概念和机制

    - Java 的类加载机制，常用版本 JDK 内嵌的 Class-Loader，例如：Bootstrap、Application 和 Extension Class-Loader

    - 类加载大致过程：加载、验证、链接、初始化

    - 自定义 Class-Loader

    - 垃圾回收的基本原理

    - 常见垃圾收集器：SerialGC、Parallel GC、CMS、G1等。

    - JDK 包含那些工具或 Java 领域内其他工具如编译器、运行时环境、安全工具、诊断和监控工具。

![1](https://static001.geekbang.org/resource/image/20/32/20bc6a900fc0b829c2f0e723df050732.png)

## 深入探索

Java 通常分为编译期和运行时，这里 Java 的编译和 C/C++ 不同，Java 源代码通过 Javac 编译成字节码文件，字节码文件不能直接运行，只能运行在 JVM 虚拟机上。

JVM 虚拟机通过类加载器(Class-Loader)加载字节码，解释或编译执行。具体是解释执行还是编译执行，根据代码特性决定，在混合模式下，JVM 根据程序运行在 server 端还是 client 端使用不同的门限值来决定是否启用编译执行，这里在不同门限情况下使用的执行方式就是 Oracle HotSpot JVM 内置的 JIT compiler 的 C1 和 C2 模式。

JVM 启动时根据指定的不同参数对运行模式进行选择，如 `"-Xint"` 指的是 JVM 只进行解释执行，不对代码进行编译，这就抛弃了 JIT 可能带来的性能优势。

还有一个参数 `-Xcomp` 参数表示关闭 JVM 解释器，不进行解释执行，也就是最大优化级别。这种情况下会导致 JVM 启动变慢很多。

还有一种叫做 AOP(Ahead-of-Time Compilation) 的编译方式，直接将字节码编译成机器码，这能避免 JIT 预热等各方面的开销，Oracle JDK 9 就引入了实验性的 AOT 特性，并增加了 jaotc 工具，使用下面命令可以将某个类或模块编译成 AOT 库：

```java
jaotc --output libHelloWorld.so HelloWorld.class
jaotc --output libjava.base.so --module java.base
```

启动时直接指定库就可以了：

```
java -XX:AOTLibrary=./libHelloWorld.so,./libjava.base.so HelloWorld
```

AOT 不仅仅只有 Oracal 这一种，业界还有像 GCJ、Excelsior JET 等第三方工具提供类似的功能。

最后，JVM 作为一个强大的平台，不仅仅只有 Java 语言可以运行在上面，合规的字节码都可以，比如Clojure、Scala、Groovy、JRuby等。